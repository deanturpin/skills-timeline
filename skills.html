<!DOCTYPE HTML>

<script type="text/javascript" src="skills.js"></script>

<script type="text/javascript">

	"use strict"

	// Don't do anything until page has loaded completely
	onload = function() {

		// Create a canvas element
		const canvas = document.createElement("canvas")
		const body = document.getElementsByTagName("body")[0]

		// Add it to the DOM
		body.appendChild(canvas)

		// Define canvas (view port)
		const context = canvas.getContext("2d")

		// Set canvas size
		const width = canvas.width = window.innerWidth
		const height = canvas.height = window.innerHeight

		// Offset from the origin
		const x = width/2
		const y = height/2

		// Create range variable and initialise to out of range
		var range = function() {

			this.min,
			this.max
		}

		// Initialise range
		range.min = 3000
		range.max = 0

		// Parse to find min and max
		for (var i = 0; i < skills.length; ++i) {

			const skill = skills[i][0]
			const start = skills[i][1]
			const end = skills[i][2]

			// Get min and max years
			if (start < range.min)
				range.min = start

			if (end > range.max)
				range.max = end
		}

		const xScale = .75 * width / (range.max - range.min)
		const yScale = height / skills.length
		const padding = 10

		// Add scale
		for (var s = 0; s < range.max - range.min; s += 2)
			context.fillText(range.min + s, s * xScale, padding)

		// Parse to print bars
		for (var i = 0; i < skills.length; ++i) {

			const skill = skills[i][0]
			const start = skills[i][1]
			const end = skills[i][2]
			const duration = skills[i][2] - skills[i][1]

			// Calculate end points
			const x1 = xScale * (start - range.min)
			const x2 = x1 + duration*xScale
			const y = 2*padding + i*yScale

			// Render stroke
			context.beginPath()
			context.moveTo(x1, y)
			context.lineTo(x2, y)
			context.lineWidth = 3
			context.stroke()

			// Add skill
			context.fillText(skill,
				padding + (range.max - range.min) * xScale, y + padding/2)
		}

		// Periodically reload the page
		setInterval(function() {

			if (window.location.href.split("?").pop() === "reload")
				window.location.reload()
		}, 2000)
	}
</script>
